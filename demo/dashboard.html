<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Sage â€” My Accounts</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ===== GDPR / AI CONSENT MODAL ===== -->
  <div class="consent-overlay" id="consent-overlay" role="dialog" aria-modal="true" aria-labelledby="consent-title">
    <div class="consent-modal">
      <div class="consent-header">
        <span class="consent-icon">ğŸ”’</span>
        <h2 id="consent-title">Before we begin</h2>
      </div>
      <div class="consent-body">
        <p><strong>AI Sage is an AI assistant, not a human financial adviser.</strong></p>
        <p>To provide personalised guidance, AI Sage will analyse your transaction data and account information. By continuing, you confirm you understand and agree to the following:</p>
        <ul>
          <li>Your financial data will be processed by an AI system to generate guidance.</li>
          <li>AI Sage provides <strong>financial guidance only</strong>, not regulated financial advice under FSMA 2000.</li>
          <li>Data is processed in accordance with our <a href="#" class="consent-link">Privacy Notice</a> and UK GDPR.</li>
          <li>You can withdraw consent or speak to a human adviser at any time.</li>
        </ul>
        <p class="consent-fos">
          <strong>Complaints:</strong> If you're unhappy with our service, contact us or the
          <strong>Financial Ombudsman Service</strong> â€” 0800 023 4567 Â·
          <a href="https://www.financial-ombudsman.org.uk" target="_blank" class="consent-link">financial-ombudsman.org.uk</a>
        </p>
      </div>
      <div class="consent-actions">
        <button class="consent-decline" onclick="declineConsent()">No thanks, close</button>
        <button class="consent-accept" onclick="acceptConsent()">I understand &amp; agree</button>
      </div>
    </div>
  </div>
  <!-- ===== END CONSENT MODAL ===== -->

  <!-- ===== TOP NAV ===== -->
  <nav class="top-nav">
    <a class="nav-brand" href="dashboard.html">
      <div class="logo-icon">ğŸ¦</div>
      <span class="logo-text">Welcome to Online Banking</span>
    </a>

    <ul class="nav-links">
      <li><a href="#" class="active">My Accounts</a></li>
      <li><a href="#">Payments</a></li>
      <li><a href="#">Cards</a></li>
      <li><a href="#">Savings</a></li>
      <li><a href="#">Help</a></li>
    </ul>

    <div class="nav-right">
      <div class="nav-user">
        <div class="nav-avatar">AJ</div>
        <span>Alex Johnson</span>
      </div>
      <a href="login.html" class="nav-logout">Log out</a>
    </div>
  </nav>

  <!-- ===== PAGE CONTENT ===== -->
  <div class="page-wrapper">

    <!-- Welcome banner -->
    <div class="welcome-banner">
      <div>
        <h1>Good morning, Alex ğŸ‘‹</h1>
        <p>Here's a snapshot of your finances. Last login: Today, 08:42</p>
      </div>
      <div class="welcome-badge">ğŸ”’ Secure session active</div>
    </div>

    <!-- AI Sage nudge notification -->
    <div class="notification-bar">
      <span class="notif-icon">ğŸ’¡</span>
      <div>
        <strong>AI Sage has spotted something.</strong>
        It looks like your income increased recently â€” great news! There may be an opportunity to boost your savings.
      </div>
      <button class="notif-cta" onclick="openChat('')">
        Ask AI Sage
      </button>
    </div>

    <!-- Account cards -->
    <div class="accounts-grid">
      <div class="account-card">
        <div class="account-card-label">Current Account</div>
        <div class="account-card-name">Everyday Current Account</div>
        <div class="account-card-balance">Â£7,639.05</div>
        <div class="account-card-sub">Available balance</div>
        <div class="account-card-number">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ 4821</div>
      </div>

      <div class="account-card savings">
        <div class="account-card-label">Savings Account</div>
        <div class="account-card-name">Instant Access Saver</div>
        <div class="account-card-balance">Â£3,250.00</div>
        <div class="account-card-sub">4.75% AER variable</div>
        <div class="account-card-number">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ 9034</div>
      </div>

      <div class="account-card credit">
        <div class="account-card-label">Credit Card</div>
        <div class="account-card-name">Platinum Rewards Card</div>
        <div class="account-card-balance">Â£842.17</div>
        <div class="account-card-sub">Balance outstanding Â· Limit Â£5,000</div>
        <div class="account-card-number">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ 7712</div>
      </div>
    </div>

    <!-- Main two-column grid -->
    <div class="main-grid">

      <!-- Left: Recent transactions -->
      <div>
        <div class="card" style="margin-bottom:20px;">
          <div class="card-header">
            <h2>Recent Transactions</h2>
            <a href="#">View all</a>
          </div>
          <div class="txn-list">

            <div class="txn-item">
              <div class="txn-icon salary">ğŸ’°</div>
              <div class="txn-details">
                <div class="txn-merchant">AI Sage Payroll â€” Employer Ltd</div>
                <div class="txn-date">Today Â· Salary credit</div>
              </div>
              <div class="txn-amount credit">+Â£3,800.00</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon nursery">ğŸ¼</div>
              <div class="txn-details">
                <div class="txn-merchant">Busy Bees Nursery</div>
                <div class="txn-date">10 Feb Â· Direct Debit</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£850.00</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon groceries">ğŸ›’</div>
              <div class="txn-details">
                <div class="txn-merchant">Sainsbury's</div>
                <div class="txn-date">9 Feb Â· Card payment</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£94.32</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon transport">ğŸš‚</div>
              <div class="txn-details">
                <div class="txn-merchant">National Rail</div>
                <div class="txn-date">8 Feb Â· Card payment</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£42.60</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon utility">ğŸ’¡</div>
              <div class="txn-details">
                <div class="txn-merchant">British Gas</div>
                <div class="txn-date">7 Feb Â· Direct Debit</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£87.00</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon eating">ğŸœ</div>
              <div class="txn-details">
                <div class="txn-merchant">Deliveroo</div>
                <div class="txn-date">7 Feb Â· Card payment</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£28.45</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon shopping">ğŸ›ï¸</div>
              <div class="txn-details">
                <div class="txn-merchant">Mamas and Papas</div>
                <div class="txn-date">4 Feb Â· Card payment</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£649.00</div>
            </div>

            <div class="txn-item">
              <div class="txn-icon groceries">ğŸ›’</div>
              <div class="txn-details">
                <div class="txn-merchant">Tesco</div>
                <div class="txn-date">3 Feb Â· Card payment</div>
              </div>
              <div class="txn-amount debit">âˆ’Â£67.18</div>
            </div>

          </div>
        </div>

        <!-- Quick actions -->
        <div class="card">
          <div class="card-header"><h2>Quick Actions</h2></div>
          <div class="quick-actions">
            <a href="#" class="qa-btn"><span class="qa-icon">ğŸ’¸</span>Pay someone</a>
            <a href="#" class="qa-btn"><span class="qa-icon">ğŸ”</span>Transfer</a>
            <a href="#" class="qa-btn"><span class="qa-icon">ğŸ“„</span>Statements</a>
            <a href="#" class="qa-btn"><span class="qa-icon">ğŸ’³</span>Manage card</a>
            <a href="#" class="qa-btn"><span class="qa-icon">ğŸ </span>Mortgage</a>
            <button class="qa-btn" onclick="openChat('')"><span class="qa-icon">ğŸ¤–</span>Ask AI Sage</button>
          </div>
        </div>
      </div>

      <!-- Right: Sidebar cards -->
      <div style="display:flex; flex-direction:column; gap:20px;">

        <!-- Financial Health Score -->
        <div class="card">
          <div class="card-header">
            <h2>Financial Health</h2>
            <a href="#" onclick="openChat('What is my financial health score?'); return false;">View details</a>
          </div>
          <div class="health-mini">
            <div class="health-score-circle">
              <span class="health-score-num">74</span>
            </div>
            <div class="health-info">
              <h3>Good â€” Grade B</h3>
              <p>Your savings rate has improved this month. Consider building your emergency fund further.</p>
            </div>
          </div>
        </div>

        <!-- Upcoming payments -->
        <div class="card">
          <div class="card-header"><h2>Upcoming Payments</h2></div>
          <div class="txn-list">
            <div class="txn-item">
              <div class="txn-icon nursery">ğŸ¼</div>
              <div class="txn-details">
                <div class="txn-merchant">Busy Bees Nursery</div>
                <div class="txn-date">Due 10 Mar Â· DD</div>
              </div>
              <div class="txn-amount debit">Â£850.00</div>
            </div>
            <div class="txn-item">
              <div class="txn-icon utility">ğŸ’¡</div>
              <div class="txn-details">
                <div class="txn-merchant">British Gas</div>
                <div class="txn-date">Due 7 Mar Â· DD</div>
              </div>
              <div class="txn-amount debit">Â£87.00</div>
            </div>
            <div class="txn-item">
              <div class="txn-icon shopping">ğŸ“º</div>
              <div class="txn-details">
                <div class="txn-merchant">Netflix</div>
                <div class="txn-date">Due 15 Mar Â· DD</div>
              </div>
              <div class="txn-amount debit">Â£10.99</div>
            </div>
          </div>
        </div>

        <!-- AI Sage promo card -->
        <div class="card" style="background: linear-gradient(135deg, #024731, #006A4E); color: white; border: none;">
          <div style="padding: 20px;">
            <div style="font-size: 1.8rem; margin-bottom: 10px;">ğŸ¤–</div>
            <h3 style="font-size:1rem; margin-bottom:8px; color:white;">Your AI Financial Coach</h3>
            <p style="font-size:0.82rem; opacity:0.85; line-height:1.5; margin-bottom:16px;">
              Ask me about your spending, savings goals, or what to do with your recent pay rise. I'm here 24/7.
            </p>
            <button onclick="openChat('')" style="
              background: #C8A951; color: #024731;
              border: none; border-radius: 20px;
              padding: 8px 20px; font-size: 0.85rem;
              font-weight: 700; cursor: pointer;
              width: 100%;
            ">
              Chat with AI Sage âœ¨
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== AI SAGE FLOATING BUTTON ===== -->
  <button id="ai-sage-btn" onclick="openChat('')" title="Chat with AI Sage">
    ğŸ¤–
    <span class="btn-badge">3</span>
  </button>
  <div id="ai-sage-tooltip">Chat with AI Sage</div>

  <!-- ===== CHAT OVERLAY ===== -->
  <div id="chat-overlay" onclick="closeChat()"></div>

  <!-- ===== CHAT PANEL ===== -->
  <div id="chat-panel">

    <div class="chat-panel-header">
      <div class="chat-panel-avatar">ğŸ¤–</div>
      <div class="chat-panel-info">
        <h3>AI Sage Financial Coach</h3>
        <p><span class="chat-status-dot"></span>Online Â· Powered by your transaction data</p>
      </div>
      <button class="trace-toggle-btn" id="trace-toggle-btn" onclick="toggleTrace()" title="Show how AI Sage thinks">ğŸ”</button>
      <button class="chat-close-btn" onclick="closeChat()">âœ•</button>
    </div>

    <!-- ===== TRACE SIDE PANEL ===== -->
    <div id="trace-panel" style="display:none;">
      <div class="trace-panel-header">
        <span>ğŸ” How AI Sage thinks</span>
        <button class="trace-close-btn" onclick="toggleTrace()">âœ•</button>
      </div>
      <div class="trace-panel-body" id="trace-panel-body">
        <div class="trace-empty">Send a message to see the reasoning trace here.</div>
      </div>
    </div>

    <!-- ===== ONBOARDING FLOW ===== -->
    <div id="onboarding-panel" style="display:none;">

      <!-- Step indicator -->
      <div class="ob-steps">
        <div class="ob-step active" id="ob-dot-1"></div>
        <div class="ob-step-line"></div>
        <div class="ob-step" id="ob-dot-2"></div>
        <div class="ob-step-line"></div>
        <div class="ob-step" id="ob-dot-3"></div>
      </div>

      <!-- Step 1: Goals -->
      <div class="ob-card" id="ob-step-1">
        <div class="ob-emoji">ğŸ¯</div>
        <h3 class="ob-title">What are you working toward?</h3>
        <p class="ob-subtitle">Tap a goal, then add a target amount and date â€” or skip the details for now.</p>

        <!-- Goal chips + inline detail cards -->
        <div class="ob-goal-list" id="ob-goal-chips">

          <div class="ob-goal-row" data-key="deposit">
            <button class="ob-chip" data-key="deposit" onclick="obToggleGoal(this)">ğŸ  House deposit</button>
            <div class="ob-detail-card" id="ob-detail-deposit" style="display:none;">
              <div class="ob-detail-label">How much do you need?</div>
              <div class="ob-detail-inputs">
                <div class="ob-amount-wrap"><span class="ob-pound">Â£</span><input class="ob-input ob-amount" type="number" min="0" placeholder="e.g. 20000" /></div>
                <input class="ob-input ob-date" type="month" title="Target date" />
              </div>
            </div>
          </div>

          <div class="ob-goal-row" data-key="emergency">
            <button class="ob-chip" data-key="emergency" onclick="obToggleGoal(this)">ğŸ›¡ï¸ Emergency fund</button>
            <div class="ob-detail-card" id="ob-detail-emergency" style="display:none;">
              <div class="ob-detail-label">Target fund size?</div>
              <div class="ob-detail-inputs">
                <div class="ob-amount-wrap"><span class="ob-pound">Â£</span><input class="ob-input ob-amount" type="number" min="0" placeholder="e.g. 6000" /></div>
                <input class="ob-input ob-date" type="month" title="Target date" />
              </div>
            </div>
          </div>

          <div class="ob-goal-row" data-key="debt">
            <button class="ob-chip" data-key="debt" onclick="obToggleGoal(this)">ğŸ’³ Pay off debt</button>
            <div class="ob-detail-card" id="ob-detail-debt" style="display:none;">
              <div class="ob-detail-label">How much debt to clear?</div>
              <div class="ob-detail-inputs">
                <div class="ob-amount-wrap"><span class="ob-pound">Â£</span><input class="ob-input ob-amount" type="number" min="0" placeholder="e.g. 3500" /></div>
                <input class="ob-input ob-date" type="month" title="Target date" />
              </div>
            </div>
          </div>

          <div class="ob-goal-row" data-key="holiday">
            <button class="ob-chip" data-key="holiday" onclick="obToggleGoal(this)">âœˆï¸ Family holiday</button>
            <div class="ob-detail-card" id="ob-detail-holiday" style="display:none;">
              <div class="ob-detail-label">Holiday budget?</div>
              <div class="ob-detail-inputs">
                <div class="ob-amount-wrap"><span class="ob-pound">Â£</span><input class="ob-input ob-amount" type="number" min="0" placeholder="e.g. 3000" /></div>
                <input class="ob-input ob-date" type="month" title="Target date" />
              </div>
            </div>
          </div>

          <div class="ob-goal-row" data-key="car">
            <button class="ob-chip" data-key="car" onclick="obToggleGoal(this)">ğŸš— New car</button>
            <div class="ob-detail-card" id="ob-detail-car" style="display:none;">
              <div class="ob-detail-label">Budget for the car?</div>
              <div class="ob-detail-inputs">
                <div class="ob-amount-wrap"><span class="ob-pound">Â£</span><input class="ob-input ob-amount" type="number" min="0" placeholder="e.g. 15000" /></div>
                <input class="ob-input ob-date" type="month" title="Target date" />
              </div>
            </div>
          </div>

          <div class="ob-goal-row" data-key="retirement">
            <button class="ob-chip" data-key="retirement" onclick="obToggleGoal(this)">â³ Early retirement</button>
            <div class="ob-detail-card" id="ob-detail-retirement" style="display:none;">
              <div class="ob-detail-label">Target retirement pot?</div>
              <div class="ob-detail-inputs">
                <div class="ob-amount-wrap"><span class="ob-pound">Â£</span><input class="ob-input ob-amount" type="number" min="0" placeholder="e.g. 500000" /></div>
                <input class="ob-input ob-date" type="month" title="Target year" />
              </div>
            </div>
          </div>

        </div>

        <!-- Custom goal -->
        <div class="ob-custom-wrap">
          <input id="ob-goal-custom" class="ob-input" type="text" placeholder="Or describe your own goalâ€¦" />
        </div>

        <div class="ob-actions">
          <button class="ob-skip" onclick="obSkip(1)">Skip for now</button>
          <button class="ob-next" onclick="obNext(1)">Next â†’</button>
        </div>
      </div>

      <!-- Step 2: Coaching style -->
      <div class="ob-card" id="ob-step-2" style="display:none;">
        <div class="ob-emoji">ğŸ’¬</div>
        <h3 class="ob-title">How do you like to be coached?</h3>
        <p class="ob-subtitle">I'll adjust how I explain things to match your style.</p>
        <div class="ob-style-options">
          <button class="ob-style-btn" data-value="concise" onclick="obSelectStyle(this)">
            <span class="ob-style-icon">âš¡</span>
            <strong>Brief & direct</strong>
            <span>Short answers, key numbers only</span>
          </button>
          <button class="ob-style-btn selected" data-value="balanced" onclick="obSelectStyle(this)">
            <span class="ob-style-icon">âš–ï¸</span>
            <strong>Balanced</strong>
            <span>Clear explanations with context</span>
          </button>
          <button class="ob-style-btn" data-value="detailed" onclick="obSelectStyle(this)">
            <span class="ob-style-icon">ğŸ“š</span>
            <strong>Detailed</strong>
            <span>Full breakdowns with examples</span>
          </button>
        </div>
        <div class="ob-actions">
          <button class="ob-back" onclick="obBack(2)">â† Back</button>
          <button class="ob-next" onclick="obNext(2)">Next â†’</button>
        </div>
      </div>

      <!-- Step 3: Topics of interest -->
      <div class="ob-card" id="ob-step-3" style="display:none;">
        <div class="ob-emoji">ğŸ“Œ</div>
        <h3 class="ob-title">What topics matter most to you?</h3>
        <p class="ob-subtitle">I'll prioritise these in my coaching and proactive tips.</p>
        <div class="ob-chips" id="ob-topic-chips">
          <button class="ob-chip" data-value="mortgage">ğŸ¡ Mortgage</button>
          <button class="ob-chip" data-value="savings">ğŸ’° Savings</button>
          <button class="ob-chip" data-value="budgeting">ğŸ“Š Budgeting</button>
          <button class="ob-chip" data-value="debt">ğŸ’³ Debt</button>
          <button class="ob-chip" data-value="investing">ğŸ“ˆ Investing</button>
          <button class="ob-chip" data-value="family finances">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family finances</button>
          <button class="ob-chip" data-value="retirement">ğŸ–ï¸ Retirement</button>
          <button class="ob-chip" data-value="tax">ğŸ§¾ Tax</button>
        </div>
        <div class="ob-actions">
          <button class="ob-back" onclick="obBack(3)">â† Back</button>
          <button class="ob-finish" onclick="obFinish()">Start coaching âœ¨</button>
        </div>
      </div>

    </div>
    <!-- ===== END ONBOARDING ===== -->

    <div class="chat-messages" id="chat-messages">
      <!-- Populated by chat_panel.js -->
    </div>

    <div class="chat-suggestions" id="chat-suggestions">
      <button class="suggestion-chip" onclick="sendSuggestion('How much am I spending each month?')">Monthly spending</button>
      <button class="suggestion-chip" onclick="sendSuggestion('What\\'s my financial health score?')">Health score</button>
      <button class="suggestion-chip" onclick="sendSuggestion('I think I might be having a baby â€” can you help me budget for childcare?')">New baby budget</button>
      <button class="suggestion-chip" onclick="sendSuggestion('Can I afford a Â£300,000 mortgage?')">Mortgage check</button>
      <button class="suggestion-chip" onclick="sendSuggestion('Where can I save money?')">Save money</button>
    </div>

    <div class="chat-input-area">
      <textarea
        id="chat-input"
        placeholder="Ask about your financesâ€¦"
        rows="1"
        onkeydown="handleInputKey(event)"
        oninput="autoResize(this)"
      ></textarea>
      <button class="chat-send-btn" id="send-btn" onclick="sendMessage()" title="Send">â¤</button>
    </div>

    <div class="fca-notice">
      <span>AI Sage is an AI assistant providing financial guidance, not regulated advice (FSMA 2000).</span>
      <span class="fca-divider">Â·</span>
      <span>Complaints: <strong>Financial Ombudsman Service</strong> 0800 023 4567</span>
      <span class="fca-divider">Â·</span>
      <span><a href="#" onclick="showPrivacyNotice()" class="fca-link">Privacy &amp; Data</a></span>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="chat_panel.js"></script>
</body>
</html>
